<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>JobQ 대시보드 (Day6)</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; margin: 24px; }
        table { border-collapse: collapse; width: 520px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f6f6f6; }
        .ts { margin: 8px 0 16px; color: #666; font-size: 13px; }
    </style>
</head>
<body>
<h2>JobQ 대시보드</h2>
<div class="ts" id="ts">-</div>

<h3>Redis Streams</h3>
<table id="q">
    <thead><tr><th>type</th><th>XLEN</th></tr></thead>
    <tbody></tbody>
</table>

<h3 style="margin-top:24px;">Job 상태</h3>
<table id="jobs">
    <thead><tr><th>Status</th><th>Count</th></tr></thead>
    <tbody></tbody>
</table>

<script>
    async function tick() {
        try {
            const q = await fetch('/admin/metrics/queue').then(r=>r.json());
            const j = await fetch('/admin/metrics/jobs').then(r=>r.json());

            document.getElementById('ts').innerText = `Updated: ${q.ts}`;

            const qBody = document.querySelector('#q tbody');
            qBody.innerHTML = '';
            Object.entries(q.streams).forEach(([type, v]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${type}</td><td>${v.xlen}</td>`;
                qBody.appendChild(tr);
            });

            const jBody = document.querySelector('#jobs tbody');
            jBody.innerHTML = '';
            Object.entries(j).forEach(([k, v]) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${k}</td><td>${v}</td>`;
                jBody.appendChild(tr);
            });
        } catch (e) {
            console.error(e);
        }
    }
    setInterval(tick, 2000);
    tick();
</script>
</body>
</html>
